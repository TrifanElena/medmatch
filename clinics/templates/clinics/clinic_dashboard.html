{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard Clinică – MedMatch{% endblock %}

{% block extra_css %}
<style>
  /* — full-screen dashboard background — */
  body {
    background: url("{% static 'images/dashboard-bg.jpg' %}") no-repeat center center fixed;
    background-size: cover;
  }

  /* — main container card — */
  .dashboard-container {
    max-width: 1000px;
    margin: 2rem auto;
    background: rgba(255,255,255,0.95);
    padding: 2rem;
    border-radius: 1rem;
    box-shadow: 0 0 30px rgba(0,0,0,0.1);
  }

  /* — header styles — */
  .dashboard-container h1,
  .dashboard-container h2 {
    color: #0b2e5a;
    margin-bottom: 1rem;
  }

  /* — quick-links button group — */
  .dashboard-actions .btn {
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
  }
  .dashboard-container .table-success td,
  .dashboard-container .table-danger td {
    color: #1e293b;
  }
  .dashboard-container .table-success .text-success,
  .dashboard-container .table-danger .text-danger {
    color: #1e293b !important;
  }

  /* — table card wrapper — */
  .table-dashboard {
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0,0,0,0.05);
  }
  .table-dashboard th {
    background: #0b2e5a;
    color: #fff;
    font-weight: 500;
  }
  .table-dashboard tbody tr:hover {
    background: rgba(11,46,90,0.05);
  }

  /* — “fulfilled” / “expired” row coloring — */
  .table-success td { background: #e6f4ea !important; }
  .table-danger td  { background: #fdecea !important; }

  /* — repurpose your “fancy” pill buttons — */
  .btn-fancy {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem 1.5rem;
    background-color: rgb(0,107,179);
    color: #fff;
    font-weight: bold;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 9999px;
    overflow: hidden;
    transition: all 0.3s ease-in-out;
    text-decoration: none;
    font-size: 0.95rem;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
  }
  .btn-fancy::before {
    content: "";
    position: absolute; top: 0; left: -100px;
    width: 100px; height: 100%;
    background: linear-gradient(120deg,
      rgba(255,255,255,0) 30%,
      rgba(255,255,255,0.8) 50%,
      rgba(255,255,255,0) 70%);
    opacity: 0.6;
  }
  .btn-fancy:hover {
    transform: scale(1.05);
    border-color: rgba(255,255,255,0.6);
  }
  .btn-fancy:hover::before {
    animation: shine 1.2s ease-out infinite;
  }
  @keyframes shine {
    0%   { left: -100px; }
    100% { left: 100%; }
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">

  <div class="dashboard-actions mb-4">
    <a href="{% url 'services:home' %}" class="btn-fancy">Acasă</a>
    <a href="{% url 'reviews:reviews_list' %}?clinic_id={{ clinic.id }}" class="btn-fancy">
      Vezi recenziile
    </a>
  </div>

  <h1>Dashboard: {{ clinic.name }}</h1>
  <p><strong>Oraș:</strong> {{ clinic.city }} &nbsp;|&nbsp;
     <strong>Adresă:</strong> {{ clinic.address }}</p>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <h2 class="mt-5">Programări</h2>

  {% if appointments %}
    <div class="table-dashboard mt-3">
      <table class="table mb-0">
        <thead>
          <tr>
            <th>Pacient</th>
            <th>Telefon</th>
            <th>Data</th>
            <th>Ora</th>
            <th>Specialitate</th>
            <th>Îndeplinită?</th>
            <th>Actualizează</th>
            <th>Acțiuni</th>
          </tr>
        </thead>
        <tbody>
          {% for appointment in appointments %}
          <tr
            class="
              {% if appointment.fulfilled %}table-success
              {% elif appointment.date < today and not appointment.fulfilled %}table-danger{% endif %}
            ">
            <td>{{ appointment.patient.full_name }}</td>
            <td>{{ appointment.patient.phone_number }}</td>
            <td>{{ appointment.date }}</td>
            <td>{{ appointment.time }}</td>
            <td>{{ appointment.specialty.name }}</td>
            <td>
              {% if appointment.fulfilled %}
                <span class="text-success">Programare îndeplinită</span>
              {% elif appointment.date < today %}
                <span class="text-danger">Expirată</span>
              {% else %}
                <form method="post" class="d-inline">
                  {% csrf_token %}
                  <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                  <input type="checkbox" name="fulfilled" id="ful_{{ appointment.id }}">
                  <label for="ful_{{ appointment.id }}">Îndeplinită</label>
              {% endif %}
            </td>
            <td>
              {% if not appointment.fulfilled and appointment.date >= today %}
                  <button type="submit" class="btn btn-sm btn-primary">Salvează</button>
                </form>
              {% endif %}
            </td>
            <td>
              {% if appointment.date < today and not appointment.fulfilled %}
                <form method="post" action="{% url 'clinics:delete_expired_appointment' %}">
                  {% csrf_token %}
                  <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                  <button type="submit" class="btn btn-sm btn-danger">
                    Șterge
                  </button>
                </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="mt-4">Nu există programări încă.</p>
  {% endif %}

</div>
{% endblock %}


<!-- <!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Clinică</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
    <div class="d-flex gap-3 mb-3">
        <a href="{% url 'services:home' %}" class="btn btn-secondary">Acasă</a>
        <a href="{% url 'reviews:reviews_list' %}?clinic_id={{ clinic.id }}" class="btn btn-outline-primary">Vezi recenziile</a>
    </div>

    <h1>Dashboard: {{ clinic.name }}</h1>
    <p><strong>Oraș:</strong> {{ clinic.city }}</p>
    <p><strong>Adresă:</strong> {{ clinic.address }}</p>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-success">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <h2 class="mt-4">Programări:</h2>
    {% if appointments %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Pacient</th>
                    <th>Telefon</th>
                    <th>Data</th>
                    <th>Ora</th>
                    <th>Specialitate</th>
                    <th>Îndeplinită?</th>
                    <th>Actualizează</th>
                    <th>Acțiuni</th>
                </tr>
            </thead>
            <tbody>
                {% for appointment in appointments %}
                <tr class="{% if appointment.fulfilled %}table-success{% elif appointment.date < today and not appointment.fulfilled %}table-danger{% endif %}">
                    <td>{{ appointment.patient.full_name }}</td>
                    <td>{{ appointment.patient.phone_number }}</td>
                    <td>{{ appointment.date }}</td>
                    <td>{{ appointment.time }}</td>
                    <td>{{ appointment.specialty.name }}</td>

                    <td>
                        {% if appointment.fulfilled %}
                            Programare îndeplinită
                        {% elif appointment.date < today %}
                            <span class="text-danger">Programare expirată</span>
                        {% else %}
                            <form method="post" style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                                <input type="checkbox" name="fulfilled">
                                <label>Îndeplinită</label>
                        {% endif %}
                    </td>

                    <td>
                        {% if not appointment.fulfilled and appointment.date >= today %}
                                <button type="submit" class="btn btn-sm btn-primary">Salvează</button>
                            </form>
                        {% endif %}
                    </td>

                    <td>
                        {% if appointment.date < today and not appointment.fulfilled %}
                            <form method="post" action="{% url 'clinics:delete_expired_appointment' %}">
                                {% csrf_token %}
                                <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                                <button type="submit" class="btn btn-sm btn-danger">Șterge</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Nu există programări încă.</p>
    {% endif %}
</body>
</html> -->
